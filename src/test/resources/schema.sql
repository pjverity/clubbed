SET SCHEMA APP;

CREATE TABLE users
(
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 2, INCREMENT BY 1),
  username VARCHAR(128) UNIQUE NOT NULL,
  first_name VARCHAR(32),
  last_name VARCHAR(64),
  password VARCHAR(64) NOT NULL,
  enabled BOOLEAN DEFAULT true NOT NULL,
  last_login TIMESTAMP WITH DEFAULT CURRENT TIMESTAMP
);

CREATE TABLE purchases
(
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 0, INCREMENT BY 1),
  username VARCHAR(128) REFERENCES users (username),
  purchase_time TIMESTAMP WITH DEFAULT CURRENT TIMESTAMP,
  quantity INTEGER
);

CREATE TABLE events
(
  id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 3, INCREMENT BY 1),
  event_datetime TIMESTAMP NOT NULL UNIQUE,
  completed BOOLEAN NOT NULL
);

CREATE TABLE event_participants
(
  event_id INTEGER NOT NULL,
  user_id INTEGER NOT NULL,
  PRIMARY KEY (event_id, user_id),
  CONSTRAINT fk_event FOREIGN KEY (event_id) REFERENCES users (id),
  CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users (id)
)